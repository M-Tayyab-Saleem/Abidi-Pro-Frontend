// src/components/UploadDocument.jsx
import React, { useState } from 'react'
import { Drawer, TextField } from '@mui/material'
import { FiUpload }          from 'react-icons/fi'
import { Spin, Alert }       from 'antd'

import FolderGrid        from './FolderGrid'
import OpenFolderScreen  from './OpenFolderScreen'
import { useFolderContents, useFileUploader, useFolderCreator } from '../../Hooks/useDrive'
import { useSelector } from 'react-redux'

export default function UploadDocument() {
  const [openedFolder, setOpenedFolder] = useState(null)
  const [drawerOpen, setDrawerOpen]     = useState(false)
  const [folderName, setFolderName]     = useState('')
  const [searchTerm, setSearchTerm]     = useState('')
    const data = useSelector((state) => state);
  const { user } = data?.auth;

  const folderId   = openedFolder?.id || 'root'
  const folderPath = `users/${user.id}/${folderId}`

  const { folders, files, loading, error, reload } = useFolderContents(folderId)
  const { create, loading: creating, error: createErr } = useFolderCreator()
  const { upload, loading: uploading, error: uploadErr } = useFileUploader()

  const toggleDrawer = (open) => () => setDrawerOpen(open)

  const handleNewFolder = async () => {
    try {
      const newFolder = await create({ name: folderName, parentId: folderId })
      setFolderName('')
      setDrawerOpen(false)
      reload()
    } catch {}
  }

  const handleFileChange = async (e) => {
    const file = e.target.files[0]
    if (!file) return
    await upload({ file, folderId, folderPath })
    reload()
  }

  if (error) return <Alert message={error.message} type="error" />

  return (
    <>
      <Drawer anchor="right" open={drawerOpen} onClose={toggleDrawer(false)}>
        <div className="p-6">
          <h2>Create Folder</h2>
          <TextField
            label="Folder Name" value={folderName}
            onChange={e => setFolderName(e.target.value)} fullWidth
          />
          <button onClick={handleNewFolder} disabled={creating}>
            {creating ? 'Creating…' : 'Create'}
          </button>
          {createErr && <Alert message={createErr.message} type="error" />}
        </div>
      </Drawer>

      {openedFolder
        ? <OpenFolderScreen folder={openedFolder} onClose={() => setOpenedFolder(null)} />
        : <div className="...">
            {/* controls: search + upload button */}
            <input type="file" onChange={handleFileChange} />
            {uploadErr && <Alert message={uploadErr.message} type="error" />}
            <button onClick={toggleDrawer(true)}>
              <FiUpload /> New Folder
            </button>

            <Spin spinning={loading}>
              <FolderGrid
                folders={folders.filter(f => f.name.includes(searchTerm))}
                onOpenFolder={(f) => setOpenedFolder(f)}
              />
            </Spin>
          </div>
      }
    </>
  )
}





// src/components/Files.jsx
import React, { useState } from 'react'
import { FaRegFolder }    from 'react-icons/fa6'
import { IoListOutline, IoFilterSharp } from 'react-icons/io5'
import { Spin, Alert }    from 'antd'
import FileTable         from './FileTable'
import FolderGrid        from './FolderGrid'
import OpenFolderScreen  from './OpenFolderScreen'

import { useFolderContents, useFileDownloader } from '../../Hooks/useDrive'
import { useSelector } from 'react-redux'

export default function Files() {
  const [viewMode, setViewMode]     = useState('table')
  const [searchTerm, setSearchTerm] = useState('Project')
  const [openedFolder, setOpenedFolder] = useState(null)
  const data = useSelector((state) => state);
  const { user } = data?.auth;
  const folderId   = openedFolder?.id || 'root'
  const folderPath = `users/${user.id}/${folderId}`

  const { folders, files, loading, error, reload } = useFolderContents(folderId)
  const { download, loading: dlLoading } = useFileDownloader()
const safeFolders = Array.isArray(folders) ? folders : [];
const safeFiles   = Array.isArray(files)   ? files   : [];

console.log("main",safeFiles);

  if (error) return <Alert message={error.message} type="error" />

  if (openedFolder) {
    return <OpenFolderScreen
      folder={openedFolder}
      onClose={() => setOpenedFolder(null)}
    />
  }

  return (
    <div className="...">
      {/* Controls (search, view toggles) */}
      {/* ...same as your JSX, updating props */}
      {/* Main Content */}
      <Spin spinning={loading}>
        {viewMode === 'grid'
          ? <FolderGrid
  folders={safeFolders}
  onOpenFolder={setOpenedFolder}
/>

          :
          <FileTable
  files={safeFiles.filter(f =>
    // typeof f.name === 'string' && f.name?.includes(searchTerm)
    true
  )}
  onDownload={download}
  loading={dlLoading}
/>
        }
      </Spin>
    </div>
  )
}



import { FiEye, FiDownload } from "react-icons/fi";

const FileTable = ({files,onDownload,loading, searchTerm = "" }) => {

console.log(files,"from component")
  const filtered = files.filter((f) => {
    const s = searchTerm.toLowerCase();
    return (
      f.fileName.toLowerCase().includes(s) ||
      f.sharedBy.toLowerCase().includes(s) ||
      f.category.toLowerCase().includes(s)
    );
  });

  return (
    <div className="bg-white rounded-xl shadow p-4 w-full">
      <div className="overflow-x-auto">
        <table className="min-w-full text-sm text-left border-separate border-spacing-0">
          <thead className="bg-gray-100">
            {["Files", "Shared by", "Shared on", "Category", "Actions"].map(
              (h) => (
                <th
                  key={h}
                  className="p-3 font-medium text-gray-700 border-r last:border-none border-gray-300"
                >
                  {h}
                </th>
              )
            )}
          </thead>
          <tbody>
            {filtered.length ? (
              filtered.map((file, i) => (
                <tr key={i} className="border-b hover:bg-gray-50">
                  <td className="p-3">{file.fileName}</td>
                  <td className="p-3">{file.sharedBy}</td>
                  <td className="p-3">{file.sharedOn}</td>
                  <td className="p-3">{file.category}</td>
                  <td className="p-3 flex items-center gap-3">
                    <button title="View" className="hover:brightness-110">
                      <FiEye className="text-lg text-purple-600" />
                    </button>
                    <button title="Download" className="hover:brightness-110">
                      <FiDownload className="text-lg text-green-600" />
                    </button>
                  </td>
                </tr>
              ))
            ) : (
              <tr>
                <td colSpan={5} className="p-4 text-center text-gray-500">
                  {searchTerm
                    ? `No files found matching “${searchTerm}”`
                    : "No files available"}
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default FileTable;
